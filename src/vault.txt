CREATE TABLE [dbo].[customers]( [id] [int] IDENTITY(1,1) NOT NULL, [name] [nvarchar](80) NOT NULL, [email] [nvarchar](80) NOT NULL, [phone] [bigint] NULL, [city] [nvarchar](50) NULL, [address] [nvarchar](80) NULL, [country] [nvarchar](50) NULL, [created_at] [datetime] NOT NULL, [discount] [tinyint] NOT NULL, CONSTRAINT [PK__customer__3213E83F6711253A] PRIMARY KEY CLUSTERED ( [id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY] ) ON [PRIMARY] GO ALTER TABLE [dbo].[customers] ADD CONSTRAINT [DF_customers_created_at] DEFAULT (getdate()) FOR [created_at] GO ALTER TABLE [dbo].[customers] ADD CONSTRAINT [DF__customers__disco__531856C7] DEFAULT ((0)) FOR [discount] GO
CREATE TABLE [dbo].[products]( [id] [int] IDENTITY(1,1) NOT NULL, [name] [nvarchar](80) NOT NULL, [description] [nvarchar](max) NOT NULL, [category_id] [int] NOT NULL, [purchase_price] [decimal](10, 2) NOT NULL, [sale_price] [decimal](10, 2) NOT NULL, [supplier_id] [int] NOT NULL, [created_at] [datetime] NOT NULL, CONSTRAINT [PK__products__3213E83FD71BE350] PRIMARY KEY CLUSTERED ( [id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY] ) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY] GO ALTER TABLE [dbo].[products] ADD CONSTRAINT [DF_products_created_at] DEFAULT (getdate()) FOR [created_at] GO ALTER TABLE [dbo].[products] WITH CHECK ADD CONSTRAINT [FK_products_category] FOREIGN KEY([category_id]) REFERENCES [dbo].[category] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[products] CHECK CONSTRAINT [FK_products_category] GO ALTER TABLE [dbo].[products] WITH CHECK ADD CONSTRAINT [FK_products_suppl] FOREIGN KEY([supplier_id]) REFERENCES [dbo].[suppliers] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[products] CHECK CONSTRAINT [FK_products_suppl] GO ALTER TABLE [dbo].[products] WITH CHECK ADD CONSTRAINT [CK_profitable_prices] CHECK (([sale_price]>=[purchase_price]*(1.19))) GO ALTER TABLE [dbo].[products] CHECK CONSTRAINT [CK_profitable_prices] GO
CREATE TABLE [dbo].[category]( [id] [int] IDENTITY(1,1) NOT NULL, [name] [nvarchar](80) NOT NULL, [created_at] [datetime] NOT NULL, CONSTRAINT [PK__category__3213E83FD35CF26D] PRIMARY KEY CLUSTERED ( [id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY] ) ON [PRIMARY] GO ALTER TABLE [dbo].[category] ADD CONSTRAINT [DF_category_created_at] DEFAULT (getdate()) FOR [created_at] GO
CREATE TABLE [dbo].[inventory]( [id] [int] IDENTITY(1,1) NOT NULL, [storage_location_id] [tinyint] NOT NULL, [product_id] [int] NOT NULL, [stock] [int] NOT NULL, [min_stock] [int] NOT NULL, CONSTRAINT [PK__inventor__3213E83FBBF5BBD2] PRIMARY KEY CLUSTERED ( [id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY], CONSTRAINT [UQ_inventory_product_location] UNIQUE NONCLUSTERED ( [product_id] ASC, [storage_location_id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY] ) ON [PRIMARY] GO ALTER TABLE [dbo].[inventory] ADD CONSTRAINT [DF_inventory_storage_location] DEFAULT ((1)) FOR [storage_location_id] GO ALTER TABLE [dbo].[inventory] ADD CONSTRAINT [DF__inventory__min_s__51300E55] DEFAULT ((0)) FOR [min_stock] GO ALTER TABLE [dbo].[inventory] WITH CHECK ADD CONSTRAINT [FK_inventory_product] FOREIGN KEY([product_id]) REFERENCES [dbo].[products] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[inventory] CHECK CONSTRAINT [FK_inventory_product] GO ALTER TABLE [dbo].[inventory] WITH CHECK ADD CONSTRAINT [FK_inventory_storagelocation] FOREIGN KEY([storage_location_id]) REFERENCES [dbo].[inventory_storagelocations] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[inventory] CHECK CONSTRAINT [FK_inventory_storagelocation] GO
CREATE TABLE [dbo].[inventory_storagelocations]( [id] [tinyint] IDENTITY(1,1) NOT NULL, [name] [nvarchar](80) NOT NULL, [created_at] [datetime] NOT NULL, CONSTRAINT [PK__inventor__3213E83F185CE139] PRIMARY KEY CLUSTERED ( [id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY] ) ON [PRIMARY] GO ALTER TABLE [dbo].[inventory_storagelocations] ADD CONSTRAINT [DF_inventory_storagelocations_created_at] DEFAULT (getdate()) FOR [created_at] GO
CREATE TABLE [dbo].[invoices]( [id] [int] IDENTITY(1,1) NOT NULL, [order_id] [int] NOT NULL, [total_price] [decimal](10, 2) NOT NULL, [total_discount] [decimal](10, 2) NOT NULL, [total_price_discounted] [decimal](10, 2) NOT NULL, [due_limit] [int] NULL, [due_date] AS (dateadd(day,[due_limit],[created_at])) PERSISTED, [overdue_fee] [decimal](10, 2) NULL, [status_id] [int] NOT NULL, [created_at] [datetime] NOT NULL, CONSTRAINT [PK__invoices__3213E83FBC9E069A] PRIMARY KEY CLUSTERED ( [id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY], CONSTRAINT [UQ_invoice_orderID] UNIQUE NONCLUSTERED ( [order_id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY] ) ON [PRIMARY] GO ALTER TABLE [dbo].[invoices] ADD CONSTRAINT [DF_invoices_due_limit] DEFAULT ((30)) FOR [due_limit] GO ALTER TABLE [dbo].[invoices] ADD CONSTRAINT [DF_invoices_overdue_fee] DEFAULT ((0)) FOR [overdue_fee] GO ALTER TABLE [dbo].[invoices] ADD CONSTRAINT [DF_invoices_created_at] DEFAULT (getdate()) FOR [created_at] GO ALTER TABLE [dbo].[invoices] WITH CHECK ADD CONSTRAINT [FK_invoices_orders] FOREIGN KEY([order_id]) REFERENCES [dbo].[orders] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[invoices] CHECK CONSTRAINT [FK_invoices_orders] GO ALTER TABLE [dbo].[invoices] WITH CHECK ADD CONSTRAINT [FK_invoices_status] FOREIGN KEY([status_id]) REFERENCES [dbo].[invoices_status] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[invoices] CHECK CONSTRAINT [FK_invoices_status] GO
CREATE TABLE [dbo].[orders]( [id] [int] IDENTITY(1,1) NOT NULL, [customer_id] [int] NOT NULL, [product_id] [int] NOT NULL, [quantity] [bigint] NOT NULL, [status_id] [int] NOT NULL, [created_at] [datetime] NOT NULL, CONSTRAINT [PK__orders__3213E83F99C761F0] PRIMARY KEY CLUSTERED ( [id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY] ) ON [PRIMARY] GO ALTER TABLE [dbo].[orders] ADD CONSTRAINT [DF_orders_status_id] DEFAULT ((1)) FOR [status_id] GO ALTER TABLE [dbo].[orders] ADD CONSTRAINT [DF_orders_created_at] DEFAULT (getdate()) FOR [created_at] GO ALTER TABLE [dbo].[orders] WITH CHECK ADD CONSTRAINT [FK_orders_customer] FOREIGN KEY([customer_id]) REFERENCES [dbo].[customers] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[orders] CHECK CONSTRAINT [FK_orders_customer] GO ALTER TABLE [dbo].[orders] WITH CHECK ADD CONSTRAINT [FK_orders_product] FOREIGN KEY([product_id]) REFERENCES [dbo].[products] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[orders] CHECK CONSTRAINT [FK_orders_product] GO ALTER TABLE [dbo].[orders] WITH CHECK ADD CONSTRAINT [FK_orders_status] FOREIGN KEY([status_id]) REFERENCES [dbo].[orders_status] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[orders] CHECK CONSTRAINT [FK_orders_status] GO
CREATE TABLE [dbo].[users]( [id] [int] IDENTITY(1,1) NOT NULL, [username] [nvarchar](80) NOT NULL, [customer_id] [int] NULL, [supplier_id] [int] NULL, [employee_id] [int] NULL, [email] [nvarchar](80) NOT NULL, [password] [nvarchar](50) NOT NULL, [created_at] [datetime] NOT NULL, CONSTRAINT [PK__users__3213E83FCF1ACAA0] PRIMARY KEY CLUSTERED ( [id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY], CONSTRAINT [UQ_user_uniqueFK] UNIQUE NONCLUSTERED ( [customer_id] ASC, [supplier_id] ASC, [employee_id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY] ) ON [PRIMARY] GO ALTER TABLE [dbo].[users] ADD CONSTRAINT [DF_users_created_at] DEFAULT (getdate()) FOR [created_at] GO ALTER TABLE [dbo].[users] WITH CHECK ADD CONSTRAINT [FK_user_cust] FOREIGN KEY([customer_id]) REFERENCES [dbo].[customers] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[users] CHECK CONSTRAINT [FK_user_cust] GO ALTER TABLE [dbo].[users] WITH CHECK ADD CONSTRAINT [FK_user_emp] FOREIGN KEY([employee_id]) REFERENCES [dbo].[employees] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[users] CHECK CONSTRAINT [FK_user_emp] GO ALTER TABLE [dbo].[users] WITH CHECK ADD CONSTRAINT [FK_user_suppl] FOREIGN KEY([supplier_id]) REFERENCES [dbo].[suppliers] ([id]) ON DELETE CASCADE GO ALTER TABLE [dbo].[users] CHECK CONSTRAINT [FK_user_suppl] GO ALTER TABLE [dbo].[users] WITH CHECK ADD CONSTRAINT [CK_user_exactlyoneFK] CHECK (([customer_id] IS NOT NULL AND [supplier_id] IS NULL AND [employee_id] IS NULL OR [customer_id] IS NULL AND [supplier_id] IS NOT NULL AND [employee_id] IS NULL OR [customer_id] IS NULL AND [supplier_id] IS NULL AND [employee_id] IS NOT NULL)) GO ALTER TABLE [dbo].[users] CHECK CONSTRAINT [CK_user_exactlyoneFK] GO
CREATE TABLE [dbo].[invoices_status]( [id] [int] IDENTITY(1,1) NOT NULL, [name] [nvarchar](80) NOT NULL, CONSTRAINT [PK__invoices__3213E83FCD4680A2] PRIMARY KEY CLUSTERED ( [id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY] ) ON [PRIMARY] GO
CREATE TABLE [dbo].[orders_status]( [id] [int] IDENTITY(1,1) NOT NULL, [name] [nvarchar](80) NOT NULL, CONSTRAINT [PK__orders_s__3213E83F5EB3FE29] PRIMARY KEY CLUSTERED ( [id] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY] ) ON [PRIMARY] GO